<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¸å¿ƒèµ„æ–™æ¸…å•</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f7f9;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
        }
        .card {
            background-color: #ffffff;
            border: 1px solid #e3e8ee;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .list-item:last-child {
            border-bottom: none;
        }
        .item-content {
            display: flex;
            align-items: center;
        }
        .item-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #3498db;
            margin-right: 15px;
        }
        .item-text {
            flex-grow: 1;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
            margin-left: 15px;
        }
        .view-btn, .download-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.2s;
            color: white;
        }
        .view-btn {
            background-color: #3498db;
        }
        .download-btn {
            background-color: #2ecc71;
        }
        .view-btn:hover, .download-btn:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }
        .view-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        .download-btn.zipping {
            background-color: #f39c12;
            cursor: wait;
        }
        .grouped-item {
            padding: 15px 0;
        }
        .grouped-item ul {
            list-style-type: disc;
            padding-left: 40px;
            margin: 10px 0;
            color: #555;
        }
        .grouped-button-container {
            text-align: center;
            margin-top: 15px;
        }
        .no-content-notice {
            color: #e74c3c;
            font-weight: bold;
            margin-left: 15px;
        }
        .multi-button-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 1200px;
            height: 85%;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
            position: relative;
        }
        .modal-title {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            flex-grow: 1;
        }
        .back-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: #3498db;
            padding: 0;
        }
        .close-btn {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover, .close-btn:focus {
            color: black;
        }
        .modal-body {
            flex-grow: 1;
            overflow-y: auto;
            padding-top: 15px;
        }
        .modal-body iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .carousel {
            position: relative;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .carousel img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 15px;
            cursor: pointer;
            font-size: 24px;
            z-index: 10;
        }
        .prev-btn { left: 10px; }
        .next-btn { right: 10px; }
        .file-list {
            list-style: none;
            padding: 0;
        }
        .file-list-item, .folder-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .file-list-item:hover, .folder-item:hover {
            background-color: #f5f5f5;
        }
        .folder-item {
            font-weight: bold;
        }
        .folder-item::before {
            content: 'ğŸ“ ';
            margin-right: 8px;
        }
        .file-list-item::before {
            content: 'ğŸ“„ ';
            margin-right: 8px;
        }
        .sub-list {
            padding-left: 20px;
            display: none; /* Initially hidden */
        }
        .folder-item.open + .sub-list {
            display: block; /* Show when folder is open */
        }
        footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9em;
            color: #777;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>éœ€è¡¥å……æ ¸æŸ¥çš„æ ¸å¿ƒèµ„æ–™æ¸…å•</h1>

    <h2>ï¼ˆä¸€ï¼‰è‚¡æƒä¸æ²»ç†ç»“æ„èµ„æ–™</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">1</span>
                <span class="item-text">è‚¡æƒç»“æ„å›¾ï¼ˆéœ€ç©¿é€è‡³å®é™…æ§åˆ¶äººï¼Œæ˜ç¡®å„å±‚çº§æŒè‚¡æ¯”ä¾‹ï¼‰</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="gqjg">æŸ¥çœ‹</button>
                <button class="download-btn" data-modal-id="gqjg">ä¸‹è½½</button>
            </div>
        </div>
        <div class="grouped-item">
            <div class="item-content">
                <span class="item-number">2</span>
                <div class="item-text">
                    <ul>
                        <li>è¿‘ä¸‰å¹´è‚¡ä¸œä¼šã€è‘£äº‹ä¼šã€ç›‘äº‹ä¼šå†³è®®åŠå®Œæ•´ä¼šè®®çºªè¦</li>
                        <li>è‘£äº‹ã€ç›‘äº‹ã€é«˜çº§ç®¡ç†äººå‘˜åå•ï¼ŒåŒ…å«å§“åã€èŒåŠ¡ã€ä»»æœŸã€è¯¦ç»†ç®€å†åŠå¤–éƒ¨å…¼èŒæƒ…å†µè¯´æ˜</li>
                        <li>è‚¡æƒè´¨æŠ¼ã€æœŸæƒæˆäºˆã€è‚¡æƒä»£æŒç­‰æƒç›Šé™åˆ¶ç›¸å…³åè®®åŠç™»è®°è¯æ˜</li>
                    </ul>
                </div>
            </div>
            <div class="grouped-button-container">
                <div class="button-group" style="display: inline-flex;">
                    <button class="view-btn" data-modal-id="gszl">æŸ¥çœ‹</button>
                    <button class="download-btn" data-modal-id="gszl">ä¸‹è½½</button>
                </div>
            </div>
        </div>
    </div>

    <h2>ï¼ˆäºŒï¼‰è´¢åŠ¡ç›¸å…³èµ„æ–™</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">3</span>
                <span class="item-text">è¿‘ä¸‰å¹´ç»ç¬¬ä¸‰æ–¹æœºæ„å®¡è®¡çš„è´¢åŠ¡æŠ¥å‘Šï¼ˆå«èµ„äº§è´Ÿå€ºè¡¨ã€åˆ©æ¶¦è¡¨ã€ç°é‡‘æµé‡è¡¨åŠé™„æ³¨ï¼‰</span>
            </div>
            <span class="no-content-notice">æ— </span>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">4</span>
                <span class="item-text">è¿‘ 6 ä¸ªæœˆæœˆåº¦è´¢åŠ¡æŠ¥è¡¨ï¼ˆå«èµ„äº§è´Ÿå€ºè¡¨ã€åˆ©æ¶¦è¡¨ã€ç°é‡‘æµé‡è¡¨ï¼‰</span>
            </div>
            <span class="no-content-notice">æ— </span>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">5</span>
                <span class="item-text">çŸ­å‰§é¡¹ç›®åŠç”µå•†ä¸šåŠ¡ç›¸å…³çš„ã€Šé¡¹ç›®é¢„ç®—è¡¨ã€‹ã€Šé¡¹ç›®è¿›åº¦ç®¡ç†è¡¨ã€‹ï¼ˆéœ€æ˜ç¡®æˆæœ¬æ„æˆã€æ”¶ç›Šé¢„æµ‹åŠæ—¶é—´èŠ‚ç‚¹ï¼‰</span>
            </div>
            <div class="button-group multi-button-container">
                <div class="button-group">
                    <button class="view-btn" data-modal-id="xmysb">é¡¹ç›®é¢„ç®—è¡¨</button>
                    <button class="download-btn" data-modal-id="xmysb">ä¸‹è½½</button>
                </div>
                <div class="button-group">
                    <button class="view-btn" data-modal-id="xmjdglb">é¡¹ç›®è¿›åº¦ç®¡ç†è¡¨</button>
                    <button class="download-btn" data-modal-id="xmjdglb">ä¸‹è½½</button>
                </div>
            </div>
        </div>
    </div>

    <h2>ï¼ˆä¸‰ï¼‰é‡å¤§åˆåŒä¸ä¸šåŠ¡èµ„æ–™</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">6</span>
                <span class="item-text">é‡‘é¢è¶… 30 ä¸‡å…ƒçš„åˆåŒå°è´¦åŠåŸä»¶ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå†…å®¹é‡‡è´­ / åˆ¶ä½œåˆåŒã€æ¸ é“åˆä½œåè®®ã€å¹¿å‘Š / ä»˜è´¹ä¸šåŠ¡åˆåŒã€çŸ¥è¯†äº§æƒæˆæƒå</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="htwj">æŸ¥çœ‹</button>
                <button class="download-btn" data-modal-id="htwj">ä¸‹è½½</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">7</span>
                <span class="item-text">è¿‘ 1-2 å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•ï¼ˆå«é¡¹ç›®åç§°ã€ä¸Šçº¿æ—¶é—´ã€æ’­æ”¾é‡ã€è¥æ”¶æ•°æ®ç­‰ï¼‰</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="djsk">æŸ¥çœ‹</button>
                <button class="download-btn" data-modal-id="djsk">ä¸‹è½½</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">8</span>
                <span class="item-text">çŸ­å‰§é¡¹ç›®åŸºç¡€èµ„æ–™ï¼Œæ¶µç›–å‰§æœ¬åˆ›ä½œå§”æ‰˜åˆåŒã€æ‹æ‘„æœåŠ¡å§”æ‰˜åˆåŒç­‰æ ¸å¿ƒåè®®ï¼ŒåŠæ‹æ‘„è®¾å¤‡è‡ªæœ‰ / ç§Ÿèµæ¸…å•ä¸ç›¸å…³åˆåŒã€‚</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="shortDramaBasic">æŸ¥çœ‹</button>
                <button class="download-btn" data-modal-id="shortDramaBasic">ä¸‹è½½</button>
            </div>
        </div>
    </div>

    <h2>ï¼ˆå››ï¼‰èµ„è´¨ä¸åˆè§„æ–‡ä»¶</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">9</span>
                <span class="item-text">è¥ä¸šæ‰§ç…§ã€å¹¿æ’­ç”µè§†èŠ‚ç›®åˆ¶ä½œç»è¥è®¸å¯è¯ã€ç½‘ç»œæ–‡åŒ–ç»è¥è®¸å¯è¯ï¼ˆè‹¥æ¶‰åŠçº¿ä¸Šä¼ æ’­ï¼‰ç­‰æ ¸å¿ƒè¯ç…§åŸä»¶åŠæœ‰æ•ˆæœŸè¯æ˜</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="zzwj">æŸ¥çœ‹</button>
                <button class="download-btn" data-modal-id="zzwj">ä¸‹è½½</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">10</span>
                <span class="item-text">è¿‘ä¸‰å¹´å®Œç¨è¯æ˜ã€æµ·å¤–ç¨åŠ¡ç™»è®°æ–‡ä»¶ã€å¤–æ±‡ç»“ç®—å¤‡æ¡ˆèµ„æ–™</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="cswj">æŸ¥çœ‹</button>
                <button class="download-btn" data-modal-id="cswj">ä¸‹è½½</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">11</span>
                <span class="item-text">ç¨åŠ¡ç­¹åˆ’è¯´æ˜ï¼ˆå¦‚é€‚ç”¨å›½é™…ç¨æ”¶åå®šï¼Œéœ€æ˜ç¡®åå®šæ¡æ¬¾åŠåº”ç”¨æƒ…å†µï¼‰</span>
            </div>
            <button class="view-btn" disabled>æŸ¥çœ‹</button>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">12</span>
                <span class="item-text">æ‹…ä¿è¯æ˜æ–‡ä»¶ï¼ˆè‹¥å­˜åœ¨è‚¡ä¸œæ‹…ä¿ï¼Œéœ€æä¾›æˆ¿äº§ã€åœŸåœ°ä½¿ç”¨æƒã€è‚¡æƒç­‰æ‹…ä¿è´¢äº§çš„æƒå±è¯æ˜åŠæ‹…ä¿åè®®ï¼‰ã€‚</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="dbzm">æŸ¥çœ‹</button>
                <button class="download-btn" data-modal-id="dbzm">ä¸‹è½½</button>
            </div>
        </div>
    </div>

    <footer>
        <p>èµ„æ–™æ¸…å•æœ€åæ›´æ–°äº <span id="last-updated"></span></p>
    </footer>
</div>

<!-- The Modal -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <button class="back-btn" style="display: none;">&larr; è¿”å›</button>
            <span class="modal-title">æ–‡ä»¶é¢„è§ˆ</span>
            <span class="close-btn">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Content will be injected here -->
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('myModal');
    const modalBody = modal.querySelector('.modal-body');
    const modalTitle = modal.querySelector('.modal-title');
    const closeBtn = modal.querySelector('.close-btn');
    const backBtn = modal.querySelector('.back-btn');

    const isMobile = /Mobi|Android/i.test(navigator.userAgent);

    const modalData = {
        "gqjg": {
            type: 'image',
            title: 'è‚¡æƒç»“æ„å›¾',
            files: [
                'è‚¡æƒæ¶æ„å›¾1.png', 'è‚¡æƒæ¶æ„å›¾2.png', 'è‚¡æƒæ¶æ„å›¾3.png',
                'è‚¡æƒæ¶æ„å›¾4.png', 'è‚¡æƒæ¶æ„å›¾5.png', 'è‚¡æƒæ¶æ„å›¾6.png'
            ]
        },
        "gszl": {
            type: 'office',
            title: 'å…¬å¸æ²»ç†æ–‡ä»¶',
            files: ['æ·±åœ³æ˜Ÿå¹»åŠ¨ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸ç« ç¨‹.docx']
        },
        "xmysb": {
            type: 'office',
            title: 'é¡¹ç›®é¢„ç®—è¡¨',
            files: ['è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/é¡¹ç›®é¢„ç®—è¡¨.xlsx']
        },
        "xmjdglb": {
            type: 'office',
            title: 'é¡¹ç›®è¿›åº¦ç®¡ç†è¡¨',
            files: ['è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/æµ·å—é¡¹ç›®è¿›ç¨‹è¡¨.xlsx']
        },
        "htwj": {
            type: 'image',
            title: 'åˆåŒæ–‡ä»¶',
            files: [
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/åˆä½œåè®®1.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/åˆä½œåè®®2.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/åˆä½œåè®®3.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/å¦‚è™æ·»ç¿¼åˆä½œåè®®1.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/å¦‚è™æ·»ç¿¼åˆä½œåè®®2.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/éƒ‘å·åˆä½œåè®®1.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/éƒ‘å·åˆä½œåè®®2.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/åˆ¶ä½œåè®®1.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/åˆ¶ä½œåè®®2.jpg'
            ]
        },
        "djsk": {
            type: 'office',
            title: 'çŸ­å‰§è¯•çœ‹é“¾æ¥',
            files: ['è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/8éƒ¨é¦–å‘è¯•çœ‹é“¾æ¥æ–‡ä»¶.xlsx']
        },
        "shortDramaBasic": {
            type: 'file-list',
            title: 'çŸ­å‰§é¡¹ç›®åŸºç¡€èµ„æ–™',
            basePath: 'çŸ­å‰§é¡¹ç›®åŸºç¡€èµ„æ–™/',
            files: {
                "åˆä½œåè®®": ["åˆä½œåè®®1.jpg", "åˆä½œåè®®2.jpg", "åˆä½œåè®®3.jpg"],
                "å‰§æœ¬åˆ›ä½œ": [
                    "ã€ŠMy Erotic Phone Companionã€‹ä¸€å¡å‰§æœ¬.pdf",
                    "å¥¹æ‰æ˜¯é‚£ä¸ªå¥³å­©0818(3).pdf",
                    "ä¸€å¡ä¸­æ–‡å‰§æœ¬-Sorry,+but+I'm+with+Your+Dad.pdf"
                ],
                "è®¾å¤‡æ¸…å•": ["è®¾å¤‡æ¸…å•.jpg"]
            }
        },
        "zzwj": {
            type: 'image',
            title: 'èµ„è´¨æ–‡ä»¶',
            files: [
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/å¹¿æ’­ç”µè§†èŠ‚ç›®åˆ¶ä½œç»è¥.jpg',
                'è¿‘1-2å¹´å·²å®Œæˆçš„çŸ­å‰§é¡¹ç›®æ¸…å•/è¥ä¸šæ‰§ç…§.jpg'
            ]
        },
        "cswj": {
            type: 'file-list',
            title: 'è´¢ç¨æ–‡ä»¶',
            basePath: '',
            files: {
                "è´¢ç¨æ–‡ä»¶": [
                    "æ·±åœ³æ˜Ÿå¹»åŠ¨ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸2024å¹´å®Œç¨è¯æ˜.pdf",
                    "æ·±åœ³æ˜Ÿå¹»åŠ¨ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸2025å¹´å®Œç¨è¯æ˜.pdf",
                    "AirwallexGlobalAccountConfirmation(1).pdf"
                ]
            }
        },
        "dbzm": {
            type: 'image',
            title: 'æ‹…ä¿è¯æ˜æ–‡ä»¶',
            files: ['ä¸åŠ¨äº§1.jpg', 'ä¸åŠ¨äº§2.jpg']
        }
    };

    const openModal = () => modal.style.display = 'block';
    const closeModal = () => {
        modal.style.display = 'none';
        backBtn.style.display = 'none';
        backBtn.onclick = null;
    };

    closeBtn.onclick = closeModal;
    window.onclick = function(event) {
        if (event.target == modal) {
            closeModal();
        }
    };
    
    function getFileNameFromPath(path) {
        return path.split('/').pop();
    }

    function handleViewClick(modalId) {
        const data = modalData[modalId];
        if (!data) return;

        modalTitle.textContent = data.title;
        modalBody.innerHTML = ''; 
        backBtn.style.display = 'none';

        // Mobile specific handling for office documents
        if (isMobile && data.type === 'office') {
            const fileUrl = data.files[0];
            window.open(fileUrl, '_blank');
            return;
        }

        openModal();

        switch (data.type) {
            case 'office':
                const officeUrl = `https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(window.location.href.split('/').slice(0, -1).join('/') + '/' + data.files[0])}`;
                modalBody.innerHTML = `<iframe src="${officeUrl}"></iframe>`;
                break;
            case 'image':
                let currentIndex = 0;
                const carousel = document.createElement('div');
                carousel.className = 'carousel';
                const img = document.createElement('img');
                
                const updateImage = () => img.src = encodeURI(data.files[currentIndex]);

                carousel.appendChild(img);

                if (data.files.length > 1) {
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'carousel-btn prev-btn';
                    prevBtn.innerHTML = '&#10094;';
                    prevBtn.onclick = () => {
                        currentIndex = (currentIndex - 1 + data.files.length) % data.files.length;
                        updateImage();
                    };
                    carousel.appendChild(prevBtn);

                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'carousel-btn next-btn';
                    nextBtn.innerHTML = '&#10095;';
                    nextBtn.onclick = () => {
                        currentIndex = (currentIndex + 1) % data.files.length;
                        updateImage();
                    };
                    carousel.appendChild(nextBtn);
                }
                modalBody.appendChild(carousel);
                updateImage();
                break;
            case 'file-list':
                const listContainer = document.createElement('ul');
                listContainer.className = 'file-list';
                
                Object.entries(data.files).forEach(([folderName, files]) => {
                    const folderItem = document.createElement('li');
                    folderItem.className = 'folder-item';
                    folderItem.textContent = folderName;
                    listContainer.appendChild(folderItem);

                    const subList = document.createElement('ul');
                    subList.className = 'sub-list';
                    
                    files.forEach(fileName => {
                        const fileItem = document.createElement('li');
                        fileItem.className = 'file-list-item';
                        fileItem.textContent = getFileNameFromPath(fileName);
                        
                        if (data.basePath) {
                            fileItem.dataset.filePath = data.basePath + folderName + '/' + fileName;
                        } else {
                            fileItem.dataset.filePath = fileName;
                        }
                        subList.appendChild(fileItem);
                    });
                    listContainer.appendChild(subList);
                });

                modalBody.appendChild(listContainer);
                break;
        }
    }

    async function handleDownloadClick(modalId, button) {
        const data = modalData[modalId];
        if (!data) return;

        const originalText = button.textContent;
        button.textContent = 'å‡†å¤‡ä¸­...';
        button.disabled = true;
        button.classList.add('zipping');

        try {
            if (data.files.length === 1 && (data.type === 'office' || (data.type === 'image' && data.files.length === 1))) {
                const fileUrl = data.files[0];
                const fileName = getFileNameFromPath(fileUrl);
                const a = document.createElement('a');
                a.href = fileUrl;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } else {
                const zip = new JSZip();
                let filesToZip = [];

                if (data.type === 'file-list') {
                     Object.entries(data.files).forEach(([folderName, files]) => {
                        files.forEach(fileName => {
                            if (data.basePath) {
                                filesToZip.push(data.basePath + folderName + '/' + fileName);
                            } else {
                                filesToZip.push(fileName);
                            }
                        });
                    });
                } else { // image gallery
                    filesToZip.push(...data.files);
                }
                
                button.textContent = 'å‹ç¼©ä¸­...';

                const promises = filesToZip.map(fileUrl => 
                    fetch(fileUrl)
                        .then(response => {
                            if (!response.ok) throw new Error(`æ— æ³•ä¸‹è½½ ${fileUrl}`);
                            return response.blob();
                        })
                        .then(blob => {
                            const fileName = getFileNameFromPath(fileUrl);
                            zip.file(fileName, blob);
                        })
                );

                await Promise.all(promises);

                const zipBlob = await zip.generateAsync({ type: "blob" });
                const zipUrl = URL.createObjectURL(zipBlob);
                
                const a = document.createElement('a');
                a.href = zipUrl;
                a.download = `${data.title || modalId}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(zipUrl);
            }
        } catch (error) {
            console.error('ä¸‹è½½æˆ–å‹ç¼©å¤±è´¥:', error);
            alert('ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯ã€‚');
        } finally {
            button.textContent = originalText;
            button.disabled = false;
            button.classList.remove('zipping');
        }
    }

    document.body.addEventListener('click', function(event) {
        // View button logic
        if (event.target.classList.contains('view-btn')) {
            const modalId = event.target.dataset.modalId;
            if (modalId) {
                handleViewClick(modalId);
            }
        }

        // Download button logic
        if (event.target.classList.contains('download-btn')) {
            const modalId = event.target.dataset.modalId;
            if (modalId) {
                handleDownloadClick(modalId, event.target);
            }
        }

        // File list logic inside modal
        if (event.target.classList.contains('file-list-item')) {
            const previousContent = modalBody.innerHTML;
            const filePath = event.target.dataset.filePath;
            const fileType = filePath.split('.').pop().toLowerCase();
            const fullUrl = `${window.location.href.split('/').slice(0, -1).join('/')}/${filePath}`;

            if (isMobile) {
                window.open(filePath, '_blank');
                return;
            }
            
            const showPreview = (content) => {
                modalBody.innerHTML = content;
                backBtn.style.display = 'block';
                backBtn.onclick = () => {
                    modalBody.innerHTML = previousContent;
                    backBtn.style.display = 'none';
                    backBtn.onclick = null;
                };
            };

            if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileType)) {
                showPreview(`<div class="carousel"><img src="${encodeURI(filePath)}"></div>`);
            } else if (['pdf', 'docx', 'xlsx', 'pptx'].includes(fileType)) {
                 const officeUrl = `https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(fullUrl)}`;
                 showPreview(`<iframe src="${officeUrl}"></iframe>`);
            } else {
                alert('ä¸æ”¯æŒé¢„è§ˆæ­¤æ–‡ä»¶ç±»å‹ã€‚');
            }
        }
        
        // Folder toggle logic
        if (event.target.classList.contains('folder-item')) {
            event.target.classList.toggle('open');
        }
    });

    // Set last updated date
    document.getElementById('last-updated').textContent = new Date().toLocaleDateString();
});
</script>

</body>
</html>