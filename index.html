<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>核心资料清单</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f7f9;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
        }
        .card {
            background-color: #ffffff;
            border: 1px solid #e3e8ee;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .list-item:last-child {
            border-bottom: none;
        }
        .item-content {
            display: flex;
            align-items: center;
        }
        .item-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #3498db;
            margin-right: 15px;
        }
        .item-text {
            flex-grow: 1;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
            margin-left: 15px;
        }
        .view-btn, .download-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.2s;
            color: white;
        }
        .view-btn {
            background-color: #3498db;
        }
        .download-btn {
            background-color: #2ecc71;
        }
        .view-btn:hover, .download-btn:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }
        .view-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        .download-btn.zipping {
            background-color: #f39c12;
            cursor: wait;
        }
        .grouped-item {
            padding: 15px 0;
        }
        .grouped-item ul {
            list-style-type: disc;
            padding-left: 40px;
            margin: 10px 0;
            color: #555;
        }
        .grouped-button-container {
            text-align: center;
            margin-top: 15px;
        }
        .no-content-notice {
            color: #e74c3c;
            font-weight: bold;
            margin-left: 15px;
        }
        .multi-button-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            position: relative;
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 1200px;
            height: 85%;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
            position: relative;
        }
        .modal-title {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            flex-grow: 1;
        }
        .back-btn {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: #3498db;
            padding: 0;
        }
        .close-btn {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover, .close-btn:focus {
            color: black;
        }
        .modal-body {
            flex-grow: 1;
            overflow-y: auto;
            padding-top: 15px;
        }
        .modal-body iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .carousel {
            position: relative;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .carousel img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 15px;
            cursor: pointer;
            font-size: 24px;
            z-index: 10;
        }
        .prev-btn { left: 10px; }
        .next-btn { right: 10px; }
        .file-list {
            list-style: none;
            padding: 0;
        }
        .file-list-item, .folder-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .file-list-item:hover, .folder-item:hover {
            background-color: #f5f5f5;
        }
        .folder-item {
            font-weight: bold;
        }
        .folder-item::before {
            content: '📁 ';
            margin-right: 8px;
        }
        .file-list-item::before {
            content: '📄 ';
            margin-right: 8px;
        }
        .sub-list {
            padding-left: 20px;
            display: none; /* Initially hidden */
        }
        .folder-item.open + .sub-list {
            display: block; /* Show when folder is open */
        }
        footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9em;
            color: #777;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>需补充核查的核心资料清单</h1>

    <h2>（一）股权与治理结构资料</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">1</span>
                <span class="item-text">股权结构图（需穿透至实际控制人，明确各层级持股比例）</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="gqjg">查看</button>
                <button class="download-btn" data-modal-id="gqjg">下载</button>
            </div>
        </div>
        <div class="grouped-item">
            <div class="item-content">
                <span class="item-number">2</span>
                <div class="item-text">
                    <ul>
                        <li>近三年股东会、董事会、监事会决议及完整会议纪要</li>
                        <li>董事、监事、高级管理人员名单，包含姓名、职务、任期、详细简历及外部兼职情况说明</li>
                        <li>股权质押、期权授予、股权代持等权益限制相关协议及登记证明</li>
                    </ul>
                </div>
            </div>
            <div class="grouped-button-container">
                <div class="button-group" style="display: inline-flex;">
                    <button class="view-btn" data-modal-id="gszl">查看</button>
                    <button class="download-btn" data-modal-id="gszl">下载</button>
                </div>
            </div>
        </div>
    </div>

    <h2>（二）财务相关资料</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">3</span>
                <span class="item-text">近三年经第三方机构审计的财务报告（含资产负债表、利润表、现金流量表及附注）</span>
            </div>
            <span class="no-content-notice">无</span>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">4</span>
                <span class="item-text">近 6 个月月度财务报表（含资产负债表、利润表、现金流量表）</span>
            </div>
            <span class="no-content-notice">无</span>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">5</span>
                <span class="item-text">短剧项目及电商业务相关的《项目预算表》《项目进度管理表》（需明确成本构成、收益预测及时间节点）</span>
            </div>
            <div class="button-group multi-button-container">
                <div class="button-group">
                    <button class="view-btn" data-modal-id="xmysb">项目预算表</button>
                    <button class="download-btn" data-modal-id="xmysb">下载</button>
                </div>
                <div class="button-group">
                    <button class="view-btn" data-modal-id="xmjdglb">项目进度管理表</button>
                    <button class="download-btn" data-modal-id="xmjdglb">下载</button>
                </div>
            </div>
        </div>
    </div>

    <h2>（三）重大合同与业务资料</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">6</span>
                <span class="item-text">金额超 30 万元的合同台账及原件，包括但不限于内容采购 / 制作合同、渠道合作协议、广告 / 付费业务合同、知识产权授权协</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="htwj">查看</button>
                <button class="download-btn" data-modal-id="htwj">下载</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">7</span>
                <span class="item-text">近 1-2 年已完成的短剧项目清单（含项目名称、上线时间、播放量、营收数据等）</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="djsk">查看</button>
                <button class="download-btn" data-modal-id="djsk">下载</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">8</span>
                <span class="item-text">短剧项目基础资料，涵盖剧本创作委托合同、拍摄服务委托合同等核心协议，及拍摄设备自有 / 租赁清单与相关合同。</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="shortDramaBasic">查看</button>
                <button class="download-btn" data-modal-id="shortDramaBasic">下载</button>
            </div>
        </div>
    </div>

    <h2>（四）资质与合规文件</h2>
    <div class="card">
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">9</span>
                <span class="item-text">营业执照、广播电视节目制作经营许可证、网络文化经营许可证（若涉及线上传播）等核心证照原件及有效期证明</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="zzwj">查看</button>
                <button class="download-btn" data-modal-id="zzwj">下载</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">10</span>
                <span class="item-text">近三年完税证明、海外税务登记文件、外汇结算备案资料</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="cswj">查看</button>
                <button class="download-btn" data-modal-id="cswj">下载</button>
            </div>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">11</span>
                <span class="item-text">税务筹划说明（如适用国际税收协定，需明确协定条款及应用情况）</span>
            </div>
            <button class="view-btn" disabled>查看</button>
        </div>
        <div class="list-item">
            <div class="item-content">
                <span class="item-number">12</span>
                <span class="item-text">担保证明文件（若存在股东担保，需提供房产、土地使用权、股权等担保财产的权属证明及担保协议）。</span>
            </div>
            <div class="button-group">
                <button class="view-btn" data-modal-id="dbzm">查看</button>
                <button class="download-btn" data-modal-id="dbzm">下载</button>
            </div>
        </div>
    </div>

    <footer>
        <p>资料清单最后更新于 <span id="last-updated"></span></p>
    </footer>
</div>

<!-- The Modal -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <button class="back-btn" style="display: none;">&larr; 返回</button>
            <span class="modal-title">文件预览</span>
            <span class="close-btn">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Content will be injected here -->
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('myModal');
    const modalBody = modal.querySelector('.modal-body');
    const modalTitle = modal.querySelector('.modal-title');
    const closeBtn = modal.querySelector('.close-btn');
    const backBtn = modal.querySelector('.back-btn');

    const isMobile = /Mobi|Android/i.test(navigator.userAgent);

    const modalData = {
        "gqjg": {
            type: 'image',
            title: '股权结构图',
            files: [
                '股权架构图1.png', '股权架构图2.png', '股权架构图3.png',
                '股权架构图4.png', '股权架构图5.png', '股权架构图6.png'
            ]
        },
        "gszl": {
            type: 'office',
            title: '公司治理文件',
            files: ['深圳星幻动网络科技有限公司章程.docx']
        },
        "xmysb": {
            type: 'office',
            title: '项目预算表',
            files: ['近1-2年已完成的短剧项目清单/项目预算表.xlsx']
        },
        "xmjdglb": {
            type: 'office',
            title: '项目进度管理表',
            files: ['近1-2年已完成的短剧项目清单/海南项目进程表.xlsx']
        },
        "htwj": {
            type: 'image',
            title: '合同文件',
            files: [
                '近1-2年已完成的短剧项目清单/合作协议1.jpg',
                '近1-2年已完成的短剧项目清单/合作协议2.jpg',
                '近1-2年已完成的短剧项目清单/合作协议3.jpg',
                '近1-2年已完成的短剧项目清单/如虎添翼合作协议1.jpg',
                '近1-2年已完成的短剧项目清单/如虎添翼合作协议2.jpg',
                '近1-2年已完成的短剧项目清单/郑州合作协议1.jpg',
                '近1-2年已完成的短剧项目清单/郑州合作协议2.jpg',
                '近1-2年已完成的短剧项目清单/制作协议1.jpg',
                '近1-2年已完成的短剧项目清单/制作协议2.jpg'
            ]
        },
        "djsk": {
            type: 'office',
            title: '短剧试看链接',
            files: ['近1-2年已完成的短剧项目清单/8部首发试看链接文件.xlsx']
        },
        "shortDramaBasic": {
            type: 'file-list',
            title: '短剧项目基础资料',
            basePath: '短剧项目基础资料/',
            files: {
                "合作协议": ["合作协议1.jpg", "合作协议2.jpg", "合作协议3.jpg"],
                "剧本创作": [
                    "《My Erotic Phone Companion》一卡剧本.pdf",
                    "她才是那个女孩0818(3).pdf",
                    "一卡中文剧本-Sorry,+but+I'm+with+Your+Dad.pdf"
                ],
                "设备清单": ["设备清单.jpg"]
            }
        },
        "zzwj": {
            type: 'image',
            title: '资质文件',
            files: [
                '近1-2年已完成的短剧项目清单/广播电视节目制作经营.jpg',
                '近1-2年已完成的短剧项目清单/营业执照.jpg'
            ]
        },
        "cswj": {
            type: 'file-list',
            title: '财税文件',
            basePath: '',
            files: {
                "财税文件": [
                    "深圳星幻动网络科技有限公司2024年完税证明.pdf",
                    "深圳星幻动网络科技有限公司2025年完税证明.pdf",
                    "AirwallexGlobalAccountConfirmation(1).pdf"
                ]
            }
        },
        "dbzm": {
            type: 'image',
            title: '担保证明文件',
            files: ['不动产1.jpg', '不动产2.jpg']
        }
    };

    const openModal = () => modal.style.display = 'block';
    const closeModal = () => {
        modal.style.display = 'none';
        backBtn.style.display = 'none';
        backBtn.onclick = null;
    };

    closeBtn.onclick = closeModal;
    window.onclick = function(event) {
        if (event.target == modal) {
            closeModal();
        }
    };
    
    function getFileNameFromPath(path) {
        return path.split('/').pop();
    }

    function handleViewClick(modalId) {
        const data = modalData[modalId];
        if (!data) return;

        modalTitle.textContent = data.title;
        modalBody.innerHTML = ''; 
        backBtn.style.display = 'none';

        // Mobile specific handling for office documents
        if (isMobile && data.type === 'office') {
            const fileUrl = data.files[0];
            window.open(fileUrl, '_blank');
            return;
        }

        openModal();

        switch (data.type) {
            case 'office':
                const officeUrl = `https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(window.location.href.split('/').slice(0, -1).join('/') + '/' + data.files[0])}`;
                modalBody.innerHTML = `<iframe src="${officeUrl}"></iframe>`;
                break;
            case 'image':
                let currentIndex = 0;
                const carousel = document.createElement('div');
                carousel.className = 'carousel';
                const img = document.createElement('img');
                
                const updateImage = () => img.src = encodeURI(data.files[currentIndex]);

                carousel.appendChild(img);

                if (data.files.length > 1) {
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'carousel-btn prev-btn';
                    prevBtn.innerHTML = '&#10094;';
                    prevBtn.onclick = () => {
                        currentIndex = (currentIndex - 1 + data.files.length) % data.files.length;
                        updateImage();
                    };
                    carousel.appendChild(prevBtn);

                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'carousel-btn next-btn';
                    nextBtn.innerHTML = '&#10095;';
                    nextBtn.onclick = () => {
                        currentIndex = (currentIndex + 1) % data.files.length;
                        updateImage();
                    };
                    carousel.appendChild(nextBtn);
                }
                modalBody.appendChild(carousel);
                updateImage();
                break;
            case 'file-list':
                const listContainer = document.createElement('ul');
                listContainer.className = 'file-list';
                
                Object.entries(data.files).forEach(([folderName, files]) => {
                    const folderItem = document.createElement('li');
                    folderItem.className = 'folder-item';
                    folderItem.textContent = folderName;
                    listContainer.appendChild(folderItem);

                    const subList = document.createElement('ul');
                    subList.className = 'sub-list';
                    
                    files.forEach(fileName => {
                        const fileItem = document.createElement('li');
                        fileItem.className = 'file-list-item';
                        fileItem.textContent = getFileNameFromPath(fileName);
                        
                        if (data.basePath) {
                            fileItem.dataset.filePath = data.basePath + folderName + '/' + fileName;
                        } else {
                            fileItem.dataset.filePath = fileName;
                        }
                        subList.appendChild(fileItem);
                    });
                    listContainer.appendChild(subList);
                });

                modalBody.appendChild(listContainer);
                break;
        }
    }

    async function handleDownloadClick(modalId, button) {
        const data = modalData[modalId];
        if (!data) return;

        const originalText = button.textContent;
        button.textContent = '准备中...';
        button.disabled = true;
        button.classList.add('zipping');

        try {
            if (data.files.length === 1 && (data.type === 'office' || (data.type === 'image' && data.files.length === 1))) {
                const fileUrl = data.files[0];
                const fileName = getFileNameFromPath(fileUrl);
                const a = document.createElement('a');
                a.href = fileUrl;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } else {
                const zip = new JSZip();
                let filesToZip = [];

                if (data.type === 'file-list') {
                     Object.entries(data.files).forEach(([folderName, files]) => {
                        files.forEach(fileName => {
                            if (data.basePath) {
                                filesToZip.push(data.basePath + folderName + '/' + fileName);
                            } else {
                                filesToZip.push(fileName);
                            }
                        });
                    });
                } else { // image gallery
                    filesToZip.push(...data.files);
                }
                
                button.textContent = '压缩中...';

                const promises = filesToZip.map(fileUrl => 
                    fetch(fileUrl)
                        .then(response => {
                            if (!response.ok) throw new Error(`无法下载 ${fileUrl}`);
                            return response.blob();
                        })
                        .then(blob => {
                            const fileName = getFileNameFromPath(fileUrl);
                            zip.file(fileName, blob);
                        })
                );

                await Promise.all(promises);

                const zipBlob = await zip.generateAsync({ type: "blob" });
                const zipUrl = URL.createObjectURL(zipBlob);
                
                const a = document.createElement('a');
                a.href = zipUrl;
                a.download = `${data.title || modalId}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(zipUrl);
            }
        } catch (error) {
            console.error('下载或压缩失败:', error);
            alert('下载失败，请检查控制台获取更多信息。');
        } finally {
            button.textContent = originalText;
            button.disabled = false;
            button.classList.remove('zipping');
        }
    }

    document.body.addEventListener('click', function(event) {
        // View button logic
        if (event.target.classList.contains('view-btn')) {
            const modalId = event.target.dataset.modalId;
            if (modalId) {
                handleViewClick(modalId);
            }
        }

        // Download button logic
        if (event.target.classList.contains('download-btn')) {
            const modalId = event.target.dataset.modalId;
            if (modalId) {
                handleDownloadClick(modalId, event.target);
            }
        }

        // File list logic inside modal
        if (event.target.classList.contains('file-list-item')) {
            const previousContent = modalBody.innerHTML;
            const filePath = event.target.dataset.filePath;
            const fileType = filePath.split('.').pop().toLowerCase();
            const fullUrl = `${window.location.href.split('/').slice(0, -1).join('/')}/${filePath}`;

            if (isMobile) {
                window.open(filePath, '_blank');
                return;
            }
            
            const showPreview = (content) => {
                modalBody.innerHTML = content;
                backBtn.style.display = 'block';
                backBtn.onclick = () => {
                    modalBody.innerHTML = previousContent;
                    backBtn.style.display = 'none';
                    backBtn.onclick = null;
                };
            };

            if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(fileType)) {
                showPreview(`<div class="carousel"><img src="${encodeURI(filePath)}"></div>`);
            } else if (['pdf', 'docx', 'xlsx', 'pptx'].includes(fileType)) {
                 const officeUrl = `https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(fullUrl)}`;
                 showPreview(`<iframe src="${officeUrl}"></iframe>`);
            } else {
                alert('不支持预览此文件类型。');
            }
        }
        
        // Folder toggle logic
        if (event.target.classList.contains('folder-item')) {
            event.target.classList.toggle('open');
        }
    });

    // Set last updated date
    document.getElementById('last-updated').textContent = new Date().toLocaleDateString();
});
</script>

</body>
</html>